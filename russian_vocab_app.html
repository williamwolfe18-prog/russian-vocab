<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#1a1d27">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Russian Vocab">
<link rel="apple-touch-icon" href="icon-180.png">
<link rel="manifest" href="manifest.json">
<title>Russian Vocabulary Trainer ‚Äî DOS Course</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<style>
:root {
  --bg:#0f1117; --surface:#1a1d27; --surface2:#22263a; --surface3:#2a2f45;
  --accent:#6c8ef5; --accent2:#a78bfa; --green:#34d399; --red:#f87171;
  --yellow:#fbbf24; --text:#e8eaf0; --text2:#9aa3c0; --text3:#5a6380;
  --border:#2d3250; --radius:12px; --shadow:0 4px 24px rgba(0,0,0,.4);
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:15px}
#app{display:flex;flex-direction:column;min-height:100vh}

/* Header */
header{background:var(--surface);border-bottom:1px solid var(--border);padding:0 24px;height:56px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:17px}
.logo-sub{color:var(--text2);font-size:12px;font-weight:400}
nav{display:flex;gap:4px}
nav button{background:none;border:none;color:var(--text2);padding:6px 14px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:all .15s}
nav button:hover{background:var(--surface2);color:var(--text)}
nav button.active{background:var(--surface3);color:var(--accent)}

main{flex:1;padding:28px 24px;max-width:1140px;margin:0 auto;width:100%}
.tab{display:none}.tab.active{display:block}

/* Panels */
.panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;margin-bottom:20px}
.panel h2{font-size:18px;font-weight:600;margin-bottom:16px}
.panel h3{font-size:15px;font-weight:600;margin-bottom:10px;color:var(--text2)}

/* Buttons */
.btn{display:inline-flex;align-items:center;gap:6px;padding:9px 18px;border-radius:8px;border:none;font-size:14px;font-weight:500;cursor:pointer;transition:all .15s}
.btn-primary{background:var(--accent);color:#fff}.btn-primary:hover{background:#5a7ef0}
.btn-secondary{background:var(--surface2);color:var(--text);border:1px solid var(--border)}.btn-secondary:hover{background:var(--surface3)}
.btn-success{background:var(--green);color:#0f1117}
.btn-danger{background:var(--red);color:#fff}
.btn-sm{padding:5px 12px;font-size:13px}
.btn:disabled{opacity:.4;cursor:not-allowed}

/* Stats */
.stats-row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px}
.stat-card{flex:1;min-width:100px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px;text-align:center}
.stat-card .num{font-size:26px;font-weight:700;color:var(--accent)}
.stat-card .lbl{font-size:12px;color:var(--text2);margin-top:2px}

/* Flashcard */
.flashcard-wrap{perspective:1200px;width:100%;max-width:560px;height:260px;cursor:pointer;margin:0 auto}
.flashcard{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .45s cubic-bezier(.25,.8,.25,1)}
.flashcard.flipped{transform:rotateY(180deg)}
.fc-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;background:var(--surface);border:1px solid var(--border);border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:28px;text-align:center;box-shadow:var(--shadow)}
.fc-back{transform:rotateY(180deg)}
.fc-label{font-size:11px;color:var(--text3);text-transform:uppercase;letter-spacing:.1em;margin-bottom:10px}
.fc-word{font-size:32px;font-weight:700;margin-bottom:6px}
.fc-hint{font-size:13px;color:var(--text2)}
.fc-gram{font-size:12px;color:var(--text3);margin-top:6px}
.fc-lesson{font-size:11px;color:var(--text3);margin-top:4px}

.rating-row{display:flex;gap:10px;margin-top:18px;flex-wrap:wrap;justify-content:center}
.rb{display:flex;flex-direction:column;align-items:center;gap:2px;padding:9px 18px;border-radius:10px;border:none;cursor:pointer;font-size:13px;font-weight:600;transition:all .15s;min-width:80px}
.rb-hard{background:rgba(248,113,113,.15);color:var(--red);border:1px solid rgba(248,113,113,.3)}.rb-hard:hover{background:rgba(248,113,113,.3)}
.rb-ok{background:rgba(251,191,36,.15);color:var(--yellow);border:1px solid rgba(251,191,36,.3)}.rb-ok:hover{background:rgba(251,191,36,.3)}
.rb-easy{background:rgba(52,211,153,.15);color:var(--green);border:1px solid rgba(52,211,153,.3)}.rb-easy:hover{background:rgba(52,211,153,.3)}
.rb .em{font-size:20px}
.session-info{font-size:13px;color:var(--text2);text-align:center;margin-bottom:10px}
.prog-wrap{background:var(--surface3);border-radius:999px;height:7px;overflow:hidden}
.prog{height:100%;background:var(--accent);border-radius:999px;transition:width .3s;width:0}

/* Pills */
.pills{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px}
.pill{padding:5px 13px;border-radius:999px;font-size:13px;font-weight:500;border:1px solid var(--border);background:var(--surface2);color:var(--text2);cursor:pointer;transition:all .15s}
.pill.active,.pill:hover{border-color:var(--accent);color:var(--accent);background:rgba(108,142,245,.1)}
.mpill{padding:6px 14px;border-radius:999px;font-size:13px;font-weight:500;border:1px solid var(--border);background:none;color:var(--text2);cursor:pointer;transition:all .15s}
.mpill.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.mpill:not(.active):hover{border-color:var(--accent);color:var(--accent)}

/* Forms */
input[type=text],input[type=number],textarea,select{background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:9px 12px;font-size:14px;width:100%;outline:none;transition:border-color .15s}
input[type=text]:focus,textarea:focus,input[type=number]:focus{border-color:var(--accent)}
textarea{resize:vertical;min-height:80px;font-family:inherit}
label{display:block;font-size:12px;color:var(--text2);margin-bottom:4px;font-weight:500}
select option{background:var(--surface2)}
.fg{margin-bottom:14px}

/* Word table */
.tbl-wrap{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.word-table{width:100%;border-collapse:collapse}
.word-table th{background:var(--surface2);padding:10px 12px;text-align:left;font-size:12px;color:var(--text2);font-weight:600;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid var(--border)}
.word-table td{padding:8px 12px;border-bottom:1px solid var(--border);font-size:14px}
.word-table tr:last-child td{border-bottom:none}
.word-table tr:hover td{background:var(--surface2)}
.wru{font-size:16px;font-weight:500;color:var(--accent2)}
.wgr{font-size:12px;color:var(--text3)}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:11px;font-weight:600}
.bn{background:rgba(108,142,245,.15);color:var(--accent)}
.bl{background:rgba(251,191,36,.15);color:var(--yellow)}
.bk{background:rgba(52,211,153,.15);color:var(--green)}

/* Quiz */
.mc-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:480px;margin:18px auto 0}
.mc-btn{padding:14px;border-radius:10px;border:1px solid var(--border);background:var(--surface2);color:var(--text);cursor:pointer;font-size:15px;transition:all .15s;text-align:center}
.mc-btn:hover{border-color:var(--accent);background:var(--surface3)}
.mc-btn.correct{border-color:var(--green);background:rgba(52,211,153,.15);color:var(--green)}
.mc-btn.wrong{border-color:var(--red);background:rgba(248,113,113,.15);color:var(--red)}
.afb{font-size:16px;font-weight:600;text-align:center;margin-top:10px;min-height:22px}
.afb.c{color:var(--green)}.afb.w{color:var(--red)}

/* Import */
.drop-zone{border:2px dashed var(--border);border-radius:var(--radius);padding:36px 20px;text-align:center;cursor:pointer;transition:all .2s}
.drop-zone:hover,.drop-zone.dragover{border-color:var(--accent);background:rgba(108,142,245,.06)}
.drop-zone .dz-icon{font-size:38px;margin-bottom:10px}
.ext-list{max-height:220px;overflow-y:auto;border:1px solid var(--border);border-radius:8px;margin-top:10px}
.ext-item{display:flex;align-items:center;justify-content:space-between;padding:7px 12px;border-bottom:1px solid var(--border);font-size:13px}
.ext-item:last-child{border-bottom:none}
.ext-ru{font-size:15px;font-weight:500;color:var(--accent2)}
.ext-en{color:var(--text2)}

/* PDF viewer */
.pdf-split{display:grid;grid-template-columns:1fr 1fr;gap:20px}
@media(max-width:800px){.pdf-split{grid-template-columns:1fr}}
#pdf-canvas-wrap{background:#fff;border-radius:8px;overflow:hidden;border:1px solid var(--border);max-height:500px;overflow-y:auto}
#pdf-canvas-wrap canvas{display:block;width:100% !important;height:auto !important}
.pdf-nav{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.pdf-nav span{font-size:13px;color:var(--text2)}

/* Session complete */
.sc-wrap{text-align:center;padding:36px 20px}
.sc-emoji{font-size:60px;margin-bottom:14px}
.sc-stats{display:flex;gap:20px;justify-content:center;margin:16px 0 24px;flex-wrap:wrap}
.sc-stat .n{font-size:30px;font-weight:700}.sc-stat .l{font-size:13px;color:var(--text2)}

/* Empty state */
.empty{text-align:center;padding:48px 20px;color:var(--text2)}
.empty .ei{font-size:46px;margin-bottom:14px}
.empty p{max-width:340px;margin:0 auto 18px;line-height:1.6}

/* Filter row */
.filter-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:14px}
.filter-row input,.filter-row select{max-width:200px}

/* Misc */
hr{border:none;border-top:1px solid var(--border);margin:18px 0}
.row{display:flex;gap:10px;align-items:center}
.mla{margin-left:auto}
small{font-size:12px;color:var(--text3)}
.mg-grid{display:grid;grid-template-columns:1fr 1fr auto;gap:8px;align-items:end}
kbd{background:var(--surface3);padding:2px 7px;border-radius:5px;font-size:12px}
.prog-bar-wrap{background:var(--surface3);border-radius:999px;height:7px;overflow:hidden;margin:6px 0}
code{color:var(--accent2);background:rgba(167,139,250,.1);padding:1px 5px;border-radius:4px;font-size:13px}

#loading{position:fixed;inset:0;background:rgba(15,17,23,.85);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
.spin{width:42px;height:42px;border:4px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
#loading p{margin-top:14px;color:var(--text2)}
#toast-c{position:fixed;bottom:22px;right:22px;display:flex;flex-direction:column;gap:7px;z-index:9998}
.toast{background:var(--surface3);border:1px solid var(--border);border-radius:10px;padding:11px 16px;font-size:14px;animation:si .2s;box-shadow:var(--shadow);max-width:300px}
.toast.success{border-color:var(--green)}.toast.error{border-color:var(--red)}
@keyframes si{from{transform:translateX(110%);opacity:0}to{transform:translateX(0);opacity:1}}

/* ‚îÄ‚îÄ Mobile / iPhone PWA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
*{-webkit-tap-highlight-color:transparent}
button,a,[role="button"]{touch-action:manipulation}
#mobile-nav{display:none}

@media(max-width:640px){
  /* Header ‚Äî hide desktop nav */
  nav{display:none}
  header{padding:0 14px;height:auto;min-height:50px;flex-wrap:wrap}
  .logo{height:50px;font-size:15px}
  .logo-sub{display:none}

  /* Bottom tab bar */
  #mobile-nav{
    display:flex;position:fixed;bottom:0;left:0;right:0;
    background:var(--surface);border-top:1px solid var(--border);
    z-index:200;padding-bottom:env(safe-area-inset-bottom);
  }
  .mn-btn{
    flex:1;display:flex;flex-direction:column;align-items:center;
    justify-content:center;padding:6px 4px 8px;
    background:none;border:none;cursor:pointer;
    color:var(--text2);font-size:10px;gap:2px;transition:color .15s;
  }
  .mn-btn.active{color:var(--accent)}
  .mn-icon{font-size:20px;line-height:1}

  /* Push content above bottom nav + safe area */
  main{padding:16px 14px calc(70px + env(safe-area-inset-bottom))}

  /* Prevent iOS auto-zoom on inputs (triggers at < 16px) */
  input[type=text],input[type=number],textarea,select{font-size:16px}

  /* Panels */
  .panel{padding:16px 14px}

  /* Stats cards */
  .stats-row{gap:6px}
  .stat-card{min-width:calc(33% - 4px);padding:10px 6px}
  .stat-card .num{font-size:20px}
  .stat-card .lbl{font-size:11px}

  /* Flashcard */
  .flashcard-wrap{height:210px}
  .fc-word{font-size:26px}
  .rating-row{gap:8px}
  .rb{min-width:70px;padding:10px 12px;font-size:12px}
  .rb .em{font-size:18px}

  /* Quiz */
  .mc-grid{max-width:100%}
  .mc-btn{font-size:14px;padding:12px 8px}

  /* Word table: horizontally scrollable */
  .tbl-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
  .word-table{min-width:460px}

  /* Add-word form */
  .mg-grid{grid-template-columns:1fr 1fr}

  /* Filter row */
  .filter-row{flex-direction:column;align-items:stretch;gap:8px}
  .filter-row input,.filter-row select{max-width:100%}

  /* Settings grid */
  .settings-grid{grid-template-columns:1fr !important}

  /* Toast: above bottom nav */
  #toast-c{right:14px;left:14px;bottom:calc(70px + env(safe-area-inset-bottom))}
  .toast{max-width:100%}

  /* Session complete stats */
  .sc-stats{gap:14px}
}
</style>
</head>
<body>
<div id="app">
<header>
  <div class="logo">
    <span style="font-size:22px">üá∑üá∫</span>
    <div>
      <div>Russian Vocab Trainer</div>
      <div class="logo-sub">DOS Course ‚Äî Lessons 1‚Äì14</div>
    </div>
  </div>
  <nav>
    <button class="active" onclick="showTab('study')">Study</button>
    <button onclick="showTab('quiz')">Quiz</button>
    <button onclick="showTab('words')">Words</button>
    <button onclick="showTab('import')">Import</button>
    <button onclick="showTab('settings')">Settings</button>
  </nav>
</header>
<main>

<!-- ‚îÄ‚îÄ STUDY TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="tab-study" class="tab active">
  <div class="stats-row">
    <div class="stat-card"><div class="num" id="s-total">0</div><div class="lbl">Total</div></div>
    <div class="stat-card"><div class="num" id="s-new" style="color:var(--accent)">0</div><div class="lbl">New</div></div>
    <div class="stat-card"><div class="num" id="s-learning" style="color:var(--yellow)">0</div><div class="lbl">Learning</div></div>
    <div class="stat-card"><div class="num" id="s-known" style="color:var(--green)">0</div><div class="lbl">Known</div></div>
    <div class="stat-card"><div class="num" id="s-streak">0</div><div class="lbl">üî• Streak</div></div>
    <div class="stat-card"><div class="num" id="s-due" style="color:var(--yellow)">0</div><div class="lbl">Due Today</div></div>
  </div>

  <div id="selector" class="panel">
    <div class="row" style="margin-bottom:16px">
      <h2 style="margin:0">Start a Session</h2>
      <div class="mla"><button class="btn btn-success btn-sm" id="start-btn" onclick="startSession()">‚ñ∂ Start</button></div>
    </div>
    <div class="fg">
      <label>Direction</label>
      <div class="pills" id="dir-pills">
        <span class="pill active" data-v="ru-en" onclick="setPill(this,'dir-pills')">üá∑üá∫‚Üíüá∫üá∏ Ru‚ÜíEn</span>
        <span class="pill" data-v="en-ru" onclick="setPill(this,'dir-pills')">üá∫üá∏‚Üíüá∑üá∫ En‚ÜíRu</span>
        <span class="pill" data-v="mixed" onclick="setPill(this,'dir-pills')">üîÄ Mixed</span>
      </div>
    </div>
    <div class="fg">
      <label>Lesson</label>
      <div class="pills" id="lesson-pills">
        <span class="pill active" data-v="all" onclick="setPill(this,'lesson-pills')">All</span>
      </div>
    </div>
    <div class="fg">
      <label>Status filter</label>
      <div class="pills" id="status-pills">
        <span class="pill active" data-v="all" onclick="setPill(this,'status-pills')">All</span>
        <span class="pill" data-v="new" onclick="setPill(this,'status-pills')">New only</span>
        <span class="pill" data-v="learning" onclick="setPill(this,'status-pills')">Learning</span>
        <span class="pill" data-v="due" onclick="setPill(this,'status-pills')">Due for review</span>
      </div>
    </div>
    <div class="fg">
      <label>Cards per session</label>
      <div class="pills" id="count-pills">
        <span class="pill" data-v="10" onclick="setPill(this,'count-pills')">10</span>
        <span class="pill active" data-v="20" onclick="setPill(this,'count-pills')">20</span>
        <span class="pill" data-v="30" onclick="setPill(this,'count-pills')">30</span>
        <span class="pill" data-v="50" onclick="setPill(this,'count-pills')">50</span>
        <span class="pill" data-v="all" onclick="setPill(this,'count-pills')">All</span>
      </div>
    </div>
    <small id="sel-count"></small>
  </div>

  <div id="fc-area" style="display:none">
    <div class="session-info" id="fc-info">Card 1 of 20</div>
    <div style="max-width:560px;margin:0 auto 10px">
      <div class="prog-wrap"><div class="prog" id="fc-prog"></div></div>
    </div>
    <div class="flashcard-wrap" onclick="flipCard()">
      <div class="flashcard" id="flashcard">
        <div class="fc-face fc-front">
          <div class="fc-label" id="fc-fl">RUSSIAN</div>
          <div class="fc-word" id="fc-fw">‚Äî</div>
          <div class="fc-hint" id="fc-fh">click to reveal</div>
          <div class="fc-gram" id="fc-fg"></div>
          <div class="fc-lesson" id="fc-fls"></div>
        </div>
        <div class="fc-face fc-back">
          <div class="fc-label" id="fc-bl">ENGLISH</div>
          <div class="fc-word" id="fc-bw">‚Äî</div>
          <div class="fc-hint" id="fc-bh"></div>
          <div class="fc-gram" id="fc-bg"></div>
        </div>
      </div>
    </div>
    <div class="rating-row" id="rating-row" style="display:none">
      <button class="rb rb-hard" onclick="rate('hard')"><span class="em">üòì</span>Hard</button>
      <button class="rb rb-ok" onclick="rate('ok')"><span class="em">ü§î</span>Got it</button>
      <button class="rb rb-easy" onclick="rate('easy')"><span class="em">üòä</span>Easy</button>
    </div>
    <div style="text-align:center;margin-top:12px;display:flex;gap:10px;justify-content:center">
      <button class="btn btn-secondary btn-sm" onclick="flipCard()">Flip (Space)</button>
      <button class="btn btn-secondary btn-sm" onclick="endSession()">End Session</button>
    </div>
  </div>

  <div id="sc-area" style="display:none" class="panel">
    <div class="sc-wrap">
      <div class="sc-emoji">üéâ</div>
      <h2 style="font-size:22px;margin-bottom:6px">Session Complete!</h2>
      <p style="color:var(--text2);margin-bottom:14px">Great work on your Russian vocabulary!</p>
      <div class="sc-stats">
        <div class="sc-stat"><div class="n" style="color:var(--green)" id="sc-e">0</div><div class="l">Easy</div></div>
        <div class="sc-stat"><div class="n" style="color:var(--yellow)" id="sc-o">0</div><div class="l">Got it</div></div>
        <div class="sc-stat"><div class="n" style="color:var(--red)" id="sc-h">0</div><div class="l">Hard</div></div>
      </div>
      <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
        <button class="btn btn-primary" onclick="startSession()">Another Session</button>
        <button class="btn btn-secondary" onclick="backToSel()">Back</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ QUIZ TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="tab-quiz" class="tab">
  <div class="panel">
    <div class="row" style="margin-bottom:14px;flex-wrap:wrap;gap:10px">
      <h2 style="margin:0">Quiz Mode</h2>
      <div class="mla" style="display:flex;gap:6px;flex-wrap:wrap">
        <button class="mpill active" data-qm="mc" onclick="setQMode(this)">Multiple Choice</button>
        <button class="mpill" data-qm="type" onclick="setQMode(this)">Type Answer</button>
      </div>
    </div>
    <div class="pills" id="ql-pills">
      <span class="pill active" data-v="all" onclick="setPill(this,'ql-pills');genQ()">All</span>
    </div>
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:14px;flex-wrap:wrap">
      <label style="margin:0;white-space:nowrap">Direction:</label>
      <select id="q-dir" onchange="genQ()" style="max-width:200px">
        <option value="ru-en">Russian ‚Üí English</option>
        <option value="en-ru">English ‚Üí Russian</option>
        <option value="mixed">Mixed</option>
      </select>
      <span style="margin-left:auto;font-size:13px;color:var(--text2)" id="q-score">Score: 0 / 0</span>
    </div>
    <div id="q-empty" class="empty" style="display:none">
      <div class="ei">üìö</div>
      <p>No words yet. Import vocabulary first!</p>
      <button class="btn btn-primary" onclick="showTab('import')">Go to Import</button>
    </div>
    <div id="q-content">
      <div style="text-align:center;margin-bottom:4px">
        <div class="fc-label" id="q-plabel">TRANSLATE TO ENGLISH</div>
        <div style="font-size:34px;font-weight:700;margin:10px 0" id="q-word">‚Äî</div>
        <div style="font-size:13px;color:var(--text2)" id="q-gram"></div>
      </div>
      <div id="mc-area"><div class="mc-grid" id="mc-opts"></div></div>
      <div id="type-area" style="display:none">
        <div style="display:flex;gap:8px;max-width:420px;margin:14px auto 0">
          <input type="text" id="type-in" placeholder="Type your answer‚Ä¶" onkeydown="if(event.key==='Enter')chkType()" autocomplete="off" autocorrect="off" spellcheck="false" style="text-align:center;font-size:16px">
          <button class="btn btn-primary" onclick="chkType()">Check</button>
        </div>
        <div class="afb" id="type-fb"></div>
        <div style="text-align:center;margin-top:8px;display:none" id="type-next">
          <button class="btn btn-secondary" onclick="genQ()">Next ‚Üí</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ WORDS TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="tab-words" class="tab">
  <div class="panel">
    <div class="row" style="margin-bottom:14px">
      <h2 style="margin:0">Word List</h2>
      <div class="mla row gap-4">
        <button class="btn btn-secondary btn-sm" onclick="exportJ()">Export JSON</button>
        <button class="btn btn-danger btn-sm" onclick="clearAll()">Clear All</button>
      </div>
    </div>
    <div class="filter-row">
      <input type="text" id="w-search" placeholder="Search‚Ä¶" oninput="renderWords()" style="max-width:200px">
      <select id="w-lesson" onchange="renderWords()" style="max-width:160px"><option value="all">All Lessons</option></select>
      <select id="w-status" onchange="renderWords()" style="max-width:140px">
        <option value="all">All Status</option>
        <option value="new">New</option>
        <option value="learning">Learning</option>
        <option value="known">Known</option>
      </select>
      <span id="w-count" style="font-size:13px;color:var(--text2)"></span>
    </div>
    <div id="words-empty" class="empty" style="display:none">
      <div class="ei">üìñ</div>
      <p>No vocabulary yet. Import words from your textbook PDFs or add them manually on the Import tab.</p>
      <button class="btn btn-primary" onclick="showTab('import')">Import Vocabulary</button>
    </div>
    <div class="tbl-wrap" id="words-tbl-wrap">
      <table class="word-table">
        <thead><tr>
          <th>Russian</th><th>English</th><th>Grammar</th><th>Lesson</th><th>Status</th><th>Actions</th>
        </tr></thead>
        <tbody id="w-tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ IMPORT TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="tab-import" class="tab">
  <!-- PDF import with side-by-side viewer -->
  <div class="panel">
    <h2>Import from PDF Textbook</h2>
    <p style="color:var(--text2);font-size:14px;line-height:1.6;margin-bottom:14px">
      Open a lesson Textbook PDF. The app scans the vocabulary list at the end and extracts Russian‚ÄìEnglish pairs. You can also browse any page in the viewer.
    </p>
    <div class="drop-zone" id="dz" onclick="document.getElementById('pdf-in').click()">
      <input type="file" id="pdf-in" accept=".pdf" style="display:none" onchange="handlePDF(event)">
      <div class="dz-icon">üìÑ</div>
      <p><strong>Click or drag a Textbook PDF here</strong></p>
      <p style="color:var(--text2);font-size:13px;margin-top:4px">e.g. L01_Textbook.pdf ‚Ä¶ L14_Textbook.pdf</p>
    </div>
    <div id="pdf-status" style="margin-top:10px;font-size:13px;color:var(--text2)"></div>

    <div id="pdf-viewer-area" style="display:none;margin-top:16px">
      <div class="pdf-split">
        <div>
          <div class="pdf-nav">
            <button class="btn btn-secondary btn-sm" onclick="changePage(-1)">‚Üê Prev</button>
            <span id="pdf-page-info">Page 1 / 1</span>
            <button class="btn btn-secondary btn-sm" onclick="changePage(1)">Next ‚Üí</button>
            <button class="btn btn-secondary btn-sm" onclick="jumpToEnd()">Jump to Vocab ‚Üí</button>
          </div>
          <div id="pdf-canvas-wrap"><canvas id="pdf-canvas"></canvas></div>
        </div>
        <div>
          <div class="row" style="margin-bottom:8px">
            <h3 style="margin:0">Extracted Words</h3>
            <div class="mla row">
              <span id="ext-count" style="font-size:13px;color:var(--text2)"></span>
              <button class="btn btn-primary btn-sm" onclick="importExtracted()" style="margin-left:8px">Add to Deck</button>
            </div>
          </div>
          <div style="margin-bottom:8px;display:flex;gap:8px;align-items:center">
            <label style="margin:0;white-space:nowrap;font-size:13px">Lesson:</label>
            <input type="number" id="ext-lesson" value="1" min="1" max="14" style="max-width:70px">
          </div>
          <div class="ext-list" id="ext-list" style="max-height:380px"></div>
          <p style="font-size:12px;color:var(--text3);margin-top:6px">Review and edit words in the Words tab after importing.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Camera / Photo OCR import -->
  <div class="panel">
    <h2>Import from Photo / Camera</h2>
    <p style="color:var(--text2);font-size:14px;line-height:1.6;margin-bottom:14px">
      Take a photo of a vocabulary list or point your camera at any Russian‚ÄìEnglish text. The app reads the words using OCR. Works best with clear, printed text in good lighting.
    </p>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px">
      <label class="btn btn-primary" style="cursor:pointer">
        üì∑ Take Photo / Choose Image
        <input type="file" id="ocr-in" accept="image/*" style="display:none" onchange="handleOCRImage(event)">
      </label>
    </div>

    <div id="ocr-area" style="display:none">
      <img id="ocr-preview" style="max-width:100%;max-height:280px;border-radius:8px;border:1px solid var(--border);display:block;margin-bottom:12px">
      <div id="ocr-status" style="font-size:13px;color:var(--text2);margin-bottom:8px"></div>
      <div class="prog-wrap" id="ocr-prog-wrap" style="display:none;margin-bottom:14px"><div class="prog" id="ocr-prog"></div></div>

      <div id="ocr-words-area" style="display:none">
        <div class="row" style="margin-bottom:8px">
          <h3 style="margin:0">Extracted Words</h3>
          <div class="mla row">
            <span id="ocr-count" style="font-size:13px;color:var(--text2)"></span>
            <button class="btn btn-primary btn-sm" onclick="importOCR()" style="margin-left:8px">Add to Deck</button>
          </div>
        </div>
        <div style="margin-bottom:8px;display:flex;gap:8px;align-items:center">
          <label style="margin:0;white-space:nowrap;font-size:13px">Lesson:</label>
          <input type="number" id="ocr-lesson" value="1" min="1" max="14" style="max-width:70px">
        </div>
        <div class="ext-list" id="ocr-list" style="max-height:300px"></div>
        <details style="margin-top:12px">
          <summary style="font-size:13px;color:var(--text2);cursor:pointer;margin-bottom:6px">Raw OCR text (edit &amp; re-parse if needed)</summary>
          <textarea id="ocr-raw" style="min-height:90px;font-size:13px;margin-top:6px"></textarea>
          <button class="btn btn-secondary btn-sm" onclick="reparseOCR()" style="margin-top:6px">‚Ü∫ Re-parse</button>
        </details>
      </div>
    </div>
  </div>

  <!-- Bulk paste -->
  <div class="panel">
    <h2>Add Words Manually</h2>
    <div class="fg">
      <label>Bulk paste ‚Äî one entry per line: <code>Russian ‚Äî English</code> or <code>Russian | English</code></label>
      <textarea id="bulk-in" placeholder="–ø—Ä–∏–≤–µ—Ç ‚Äî hello&#10;—Å–ø–∞—Å–∏–±–æ ‚Äî thank you&#10;–ø–æ–∂–∞–ª—É–π—Å—Ç–∞ ‚Äî please / you're welcome"></textarea>
    </div>
    <div style="display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap;margin-bottom:14px">
      <div class="fg" style="margin:0">
        <label>Lesson</label>
        <select id="bulk-lesson" style="max-width:120px">
          <option value="1">Lesson 1</option><option value="2">Lesson 2</option><option value="3">Lesson 3</option>
          <option value="4">Lesson 4</option><option value="5">Lesson 5</option><option value="6">Lesson 6</option>
          <option value="7">Lesson 7</option><option value="8">Lesson 8</option><option value="9">Lesson 9</option>
          <option value="10">Lesson 10</option><option value="11">Lesson 11</option><option value="12">Lesson 12</option>
          <option value="13">Lesson 13</option><option value="14">Lesson 14</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="importBulk()">Import</button>
    </div>
    <hr>
    <h3>Single Word</h3>
    <div class="mg-grid">
      <div><label>Russian</label><input type="text" id="m-ru" placeholder="—Å–ª–æ–≤–æ" autocomplete="off" autocorrect="off" spellcheck="false"></div>
      <div><label>English</label><input type="text" id="m-en" placeholder="word" onkeydown="if(event.key==='Enter')addWord()"></div>
      <div><label>Grammar</label><input type="text" id="m-gr" placeholder="(m)" style="max-width:90px"></div>
    </div>
    <div style="display:flex;gap:10px;margin-top:10px;align-items:flex-end;flex-wrap:wrap">
      <div><label>Lesson</label>
        <select id="m-lesson" style="max-width:100px">
          <option value="1">1</option><option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5</option><option value="6">6</option>
          <option value="7">7</option><option value="8">8</option><option value="9">9</option>
          <option value="10">10</option><option value="11">11</option><option value="12">12</option>
          <option value="13">13</option><option value="14">14</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="addWord()">Add Word</button>
    </div>
    <hr>
    <h3>Import JSON Backup</h3>
    <textarea id="json-in" placeholder='[{"ru":"–ø—Ä–∏–≤–µ—Ç","en":"hello","lesson":1}]'></textarea>
    <button class="btn btn-secondary" onclick="importJSON()" style="margin-top:8px">Import JSON</button>
  </div>
</div>

<!-- ‚îÄ‚îÄ SETTINGS TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="tab-settings" class="tab">
  <div class="panel">
    <h2>Settings</h2>
    <div class="settings-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
      <div>
        <div class="fg"><label>Show grammar on cards</label>
          <select id="set-gram"><option value="yes">Yes</option><option value="no">No</option></select></div>
        <div class="fg"><label>Spaced repetition</label>
          <select id="set-srs"><option value="yes">Enabled (recommended)</option><option value="no">Disabled (random)</option></select></div>
      </div>
      <div>
        <label>Keyboard shortcuts</label>
        <div style="font-size:13px;color:var(--text2);line-height:2.2;margin-top:6px">
          <div><kbd>Space</kbd> Flip card</div>
          <div><kbd>1</kbd> Hard ¬∑ <kbd>2</kbd> OK ¬∑ <kbd>3</kbd> Easy</div>
          <div><kbd>Enter</kbd> Submit quiz answer</div>
        </div>
      </div>
    </div>
    <button class="btn btn-primary" onclick="saveSettings()" style="margin-top:4px">Save</button>
  </div>
  <div class="panel">
    <h2>Load Starter Vocabulary</h2>
    <p style="color:var(--text2);font-size:14px;line-height:1.6;margin-bottom:14px">
      Pre-loaded vocabulary covering key words for all 14 lessons of this DOS/FSI Russian course.
      These are the core words you'll encounter; use the PDF Import to add the complete textbook lists on top.
    </p>
    <button class="btn btn-primary" onclick="loadStarter()">Load Starter Vocab (~500 words)</button>
    <button class="btn btn-secondary" onclick="clearAll()" style="margin-left:8px">Reset All Progress</button>
  </div>
  <div class="panel">
    <h2>About</h2>
    <p style="color:var(--text2);font-size:14px;line-height:1.7">
      Russian Vocabulary Trainer for the DOS/FSI Russian Language Course (Lessons 1‚Äì14).<br>
      Implements a three-box spaced repetition system: <span style="color:var(--accent)">New</span> ‚Üí
      <span style="color:var(--yellow)">Learning</span> ‚Üí <span style="color:var(--green)">Known</span>.<br>
      PDF import uses <strong>PDF.js</strong> for accurate Cyrillic text extraction. Data is stored locally in your browser.
    </p>
  </div>
</div>

</main>

<div id="mobile-nav">
  <button class="mn-btn active" onclick="showTab('study')"><span class="mn-icon">üÉè</span><span>Study</span></button>
  <button class="mn-btn" onclick="showTab('quiz')"><span class="mn-icon">‚ùì</span><span>Quiz</span></button>
  <button class="mn-btn" onclick="showTab('words')"><span class="mn-icon">üìù</span><span>Words</span></button>
  <button class="mn-btn" onclick="showTab('import')"><span class="mn-icon">‚ûï</span><span>Import</span></button>
  <button class="mn-btn" onclick="showTab('settings')"><span class="mn-icon">‚öôÔ∏è</span><span>Settings</span></button>
</div>

</div>
<div id="toast-c"></div>
<div id="loading" style="display:none;flex-direction:column;align-items:center;justify-content:center">
  <div class="spin"></div><p id="load-txt">Processing‚Ä¶</p>
</div>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

// ‚îÄ‚îÄ Data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let vocab=[], settings={showGram:'yes',srs:'yes'}, streak=0;
const SK='rus_vocab_v3', SET='rus_settings', STRK='rus_streak';

function load(){
  try{vocab=JSON.parse(localStorage.getItem(SK)||'[]')}catch(e){vocab=[]}
  try{settings={...settings,...JSON.parse(localStorage.getItem(SET)||'{}')}}catch(e){}
  try{
    const sd=JSON.parse(localStorage.getItem(STRK)||'{}');
    const today=new Date().toDateString();
    const yest=new Date(Date.now()-86400000).toDateString();
    streak=sd.date===today?sd.streak:sd.date===yest?(sd.streak||0):0;
  }catch(e){}
  applySettings(); updateStats(); renderLessonPills(); renderQPills();
}
function save(){localStorage.setItem(SK,JSON.stringify(vocab));updateStats()}
function applySettings(){
  document.getElementById('set-gram').value=settings.showGram;
  document.getElementById('set-srs').value=settings.srs;
}
function saveSettings(){
  settings.showGram=document.getElementById('set-gram').value;
  settings.srs=document.getElementById('set-srs').value;
  localStorage.setItem(SET,JSON.stringify(settings));toast('Settings saved','success');
}
function updStreak(){
  const today=new Date().toDateString();
  let sd={}; try{sd=JSON.parse(localStorage.getItem(STRK)||'{}')}catch(e){}
  if(sd.date===today)return;
  const yest=new Date(Date.now()-86400000).toDateString();
  streak=sd.date===yest?(sd.streak||0)+1:1;
  localStorage.setItem(STRK,JSON.stringify({date:today,streak}));
  document.getElementById('s-streak').textContent=streak;
}

// ‚îÄ‚îÄ Stats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateStats(){
  const now=Date.now();
  const nw=vocab.filter(w=>!w.status||w.status==='new').length;
  const lrn=vocab.filter(w=>w.status==='learning').length;
  const kn=vocab.filter(w=>w.status==='known').length;
  const due=vocab.filter(w=>w.nextReview&&w.nextReview<=now&&w.status!=='new').length;
  document.getElementById('s-total').textContent=vocab.length;
  document.getElementById('s-new').textContent=nw;
  document.getElementById('s-learning').textContent=lrn;
  document.getElementById('s-known').textContent=kn;
  document.getElementById('s-streak').textContent=streak;
  document.getElementById('s-due').textContent=due;
  updateSelCount();
}

// ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showTab(name){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  const names=['study','quiz','words','import','settings'];
  document.querySelectorAll('nav button')[names.indexOf(name)].classList.add('active');
  document.querySelectorAll('#mobile-nav .mn-btn').forEach(b=>b.classList.remove('active'));
  const mni=document.querySelectorAll('#mobile-nav .mn-btn')[names.indexOf(name)];
  if(mni)mni.classList.add('active');
  if(name==='words')renderWords();
  if(name==='quiz'){renderQPills();genQ();}
  if(name==='study'){backToSel();updateStats();}
}

// ‚îÄ‚îÄ Pills helper ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setPill(el,groupId){
  document.querySelectorAll('#'+groupId+' .pill').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  updateSelCount();
}
function getPill(groupId){
  const el=document.querySelector('#'+groupId+' .pill.active');
  return el?el.dataset.v:'all';
}
function renderLessonPills(){
  const lessons=[...new Set(vocab.map(w=>w.lesson).filter(Boolean))].sort((a,b)=>a-b);
  const lp=document.getElementById('lesson-pills');
  if(lp){
    const cur=getPill('lesson-pills');
    lp.innerHTML='<span class="pill'+(cur==='all'?' active':'')+'" data-v="all" onclick="setPill(this,\'lesson-pills\')">All</span>'+
      lessons.map(l=>`<span class="pill${cur===String(l)?' active':''}" data-v="${l}" onclick="setPill(this,'lesson-pills')">L${l}</span>`).join('');
  }
  const wl=document.getElementById('w-lesson');
  if(wl){wl.innerHTML='<option value="all">All Lessons</option>'+lessons.map(l=>`<option value="${l}">Lesson ${l}</option>`).join('');}
}
function renderQPills(){
  const lessons=[...new Set(vocab.map(w=>w.lesson).filter(Boolean))].sort((a,b)=>a-b);
  const qp=document.getElementById('ql-pills');
  if(qp){
    const cur=getPill('ql-pills');
    qp.innerHTML='<span class="pill'+(cur==='all'?' active':'')+'" data-v="all" onclick="setPill(this,\'ql-pills\');genQ()">All</span>'+
      lessons.map(l=>`<span class="pill${cur===String(l)?' active':''}" data-v="${l}" onclick="setPill(this,'ql-pills');genQ()">L${l}</span>`).join('');
  }
}

// ‚îÄ‚îÄ Session ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let cards=[], idx=0, results={easy:0,ok:0,hard:0}, flipped=false;

function getFilteredForSession(){
  const dir=getPill('lesson-pills'); const st=getPill('status-pills'); const now=Date.now();
  return vocab.filter(w=>{
    const ml=dir==='all'||String(w.lesson)===String(dir);
    let ms=true;
    if(st==='new') ms=!w.status||w.status==='new';
    else if(st==='learning') ms=w.status==='learning';
    else if(st==='due') ms=w.nextReview&&w.nextReview<=now;
    return ml&&ms;
  });
}

function updateSelCount(){
  const words=getFilteredForSession();
  const cnt=getPill('count-pills');
  const max=cnt==='all'?words.length:Math.min(parseInt(cnt)||20,words.length);
  const el=document.getElementById('sel-count');
  if(el) el.textContent=`${max} cards will be shown (${words.length} matching your filters)`;
}

function startSession(){
  if(vocab.length===0){toast('Import some vocabulary first!','error');showTab('import');return;}
  let words=getFilteredForSession();
  if(words.length===0){toast('No words match current filters','error');return;}
  if(settings.srs==='yes'){
    const now=Date.now();
    words.sort((a,b)=>(a.nextReview||0)-(b.nextReview||0));
  } else {
    words=shuffle(words);
  }
  const cnt=getPill('count-pills');
  const limit=cnt==='all'?words.length:Math.min(parseInt(cnt)||20,words.length);
  cards=words.slice(0,limit);
  idx=0; results={easy:0,ok:0,hard:0};
  document.getElementById('selector').style.display='none';
  document.getElementById('sc-area').style.display='none';
  document.getElementById('fc-area').style.display='block';
  showCard(); updStreak();
}

const DIR_MAP={
  'ru-en':{front:'ru',back:'en',fl:'RUSSIAN',bl:'ENGLISH'},
  'en-ru':{front:'en',back:'ru',fl:'ENGLISH',bl:'RUSSIAN'},
};
let curDir='ru-en';

function showCard(){
  const c=cards[idx];
  if(!c){showSC();return;}
  flipped=false;
  document.getElementById('flashcard').classList.remove('flipped');
  document.getElementById('rating-row').style.display='none';
  const d=getPill('dir-pills');
  curDir=d==='mixed'?(Math.random()<.5?'ru-en':'en-ru'):d;
  const dm=DIR_MAP[curDir]||DIR_MAP['ru-en'];
  document.getElementById('fc-fl').textContent=dm.fl;
  document.getElementById('fc-fw').textContent=c[dm.front];
  document.getElementById('fc-fh').textContent='click to reveal';
  document.getElementById('fc-fg').textContent=settings.showGram==='yes'&&c.grammar?c.grammar:'';
  document.getElementById('fc-fls').textContent=`Lesson ${c.lesson||'?'}`;
  document.getElementById('fc-bl').textContent=dm.bl;
  document.getElementById('fc-bw').textContent=c[dm.back];
  document.getElementById('fc-bh').textContent='';
  document.getElementById('fc-bg').textContent=settings.showGram==='yes'&&c.grammar?c.grammar:'';
  const pct=(idx/cards.length)*100;
  document.getElementById('fc-prog').style.width=pct+'%';
  const cor=results.easy+results.ok;
  document.getElementById('fc-info').textContent=`Card ${idx+1} of ${cards.length} ¬∑ ${cor} correct`;
}

function flipCard(){
  if(flipped)return;
  flipped=true;
  document.getElementById('flashcard').classList.add('flipped');
  document.getElementById('fc-fh').textContent='';
  document.getElementById('rating-row').style.display='flex';
}

function rate(r){
  const c=cards[idx]; if(!c)return;
  results[r]++;
  const w=vocab.find(v=>v.id===c.id);
  if(w){
    w.reviews=(w.reviews||0)+1;
    if(r==='easy'){w.status='known';w.easiness=Math.min(3,(w.easiness||2.5)+0.1);w.interval=Math.max(1,(w.interval||1))*(w.easiness||2.5);}
    else if(r==='ok'){w.status=w.reviews>2?'known':'learning';w.easiness=w.easiness||2.5;w.interval=Math.max(1,(w.interval||1))*1.5;}
    else{w.status='learning';w.easiness=Math.max(1.3,(w.easiness||2.5)-0.2);w.interval=1;}
    w.nextReview=Date.now()+(w.interval||1)*86400000;
    save();
  }
  idx++; setTimeout(showCard,200);
}

function showSC(){
  document.getElementById('fc-area').style.display='none';
  document.getElementById('sc-area').style.display='block';
  document.getElementById('sc-e').textContent=results.easy;
  document.getElementById('sc-o').textContent=results.ok;
  document.getElementById('sc-h').textContent=results.hard;
  save();
}
function endSession(){showSC();}
function backToSel(){
  document.getElementById('fc-area').style.display='none';
  document.getElementById('sc-area').style.display='none';
  document.getElementById('selector').style.display='block';
  updateSelCount();
}

// ‚îÄ‚îÄ Quiz ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let qMode='mc', qWord=null, qDir='ru-en', qCorrect=0, qTotal=0;

function setQMode(btn){
  document.querySelectorAll('.mpill[data-qm]').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active'); qMode=btn.dataset.qm;
  document.getElementById('mc-area').style.display=qMode==='mc'?'block':'none';
  document.getElementById('type-area').style.display=qMode==='type'?'block':'none';
  genQ();
}

function genQ(){
  let pool=[...vocab];
  const ql=getPill('ql-pills');
  if(ql!=='all') pool=pool.filter(w=>String(w.lesson)===String(ql));
  if(pool.length<2){
    document.getElementById('q-empty').style.display='block';
    document.getElementById('q-content').style.display='none';
    return;
  }
  document.getElementById('q-empty').style.display='none';
  document.getElementById('q-content').style.display='block';
  const dv=document.getElementById('q-dir').value;
  qDir=dv==='mixed'?(Math.random()<.5?'ru-en':'en-ru'):dv;
  qWord=pool[Math.floor(Math.random()*pool.length)];
  const prompt=qDir==='ru-en'?qWord.ru:qWord.en;
  const lbl=qDir==='ru-en'?'TRANSLATE TO ENGLISH':'TRANSLATE TO RUSSIAN';
  document.getElementById('q-plabel').textContent=lbl;
  document.getElementById('q-word').textContent=prompt;
  document.getElementById('q-gram').textContent=settings.showGram==='yes'&&qWord.grammar?qWord.grammar:'';
  if(qMode==='mc') renderMC(pool);
  if(qMode==='type'){
    document.getElementById('type-in').value='';
    document.getElementById('type-fb').textContent='';
    document.getElementById('type-fb').className='afb';
    document.getElementById('type-next').style.display='none';
    setTimeout(()=>document.getElementById('type-in').focus(),50);
  }
  document.getElementById('q-score').textContent=`Score: ${qCorrect} / ${qTotal}`;
}

function renderMC(pool){
  const correct=qDir==='ru-en'?qWord.en:qWord.ru;
  const wrongs=shuffle(pool.filter(w=>w.id!==qWord.id)).slice(0,3).map(w=>qDir==='ru-en'?w.en:w.ru);
  const opts=shuffle([correct,...wrongs]);
  document.getElementById('mc-opts').innerHTML=opts.map(o=>
    `<button class="mc-btn" onclick="chkMC(this,'${esc(o)}','${esc(correct)}')">${esc(o)}</button>`
  ).join('');
}

function chkMC(btn,chosen,correct){
  if(btn.classList.contains('correct')||btn.classList.contains('wrong'))return;
  qTotal++;
  document.querySelectorAll('.mc-btn').forEach(b=>b.onclick=null);
  if(chosen===correct){
    btn.classList.add('correct'); qCorrect++;
    updateQWord(true); setTimeout(genQ,900);
  } else {
    btn.classList.add('wrong');
    document.querySelectorAll('.mc-btn').forEach(b=>{if(b.textContent===correct)b.classList.add('correct');});
    updateQWord(false); setTimeout(genQ,1400);
  }
  document.getElementById('q-score').textContent=`Score: ${qCorrect} / ${qTotal}`;
}

function chkType(){
  const inp=document.getElementById('type-in').value.trim();
  const correct=qDir==='ru-en'?qWord.en:qWord.ru;
  qTotal++; const fb=document.getElementById('type-fb'); const nxt=document.getElementById('type-next');
  if(norm(inp)===norm(correct)){
    fb.textContent='‚úì Correct!'; fb.className='afb c'; qCorrect++;
    updateQWord(true); setTimeout(genQ,700);
  } else {
    fb.textContent=`‚úó Answer: ${correct}`; fb.className='afb w';
    nxt.style.display='block'; updateQWord(false);
  }
  document.getElementById('q-score').textContent=`Score: ${qCorrect} / ${qTotal}`;
}

function updateQWord(correct){
  if(!qWord) return;
  const w=vocab.find(v=>v.id===qWord.id); if(!w) return;
  w.reviews=(w.reviews||0)+1;
  if(correct&&w.status!=='known') w.status=w.reviews>3?'known':'learning';
  else if(!correct) w.status='learning';
  save();
}

function norm(s){return s.toLowerCase().replace(/[.,!?;:'"()\[\]{}]/g,'').replace(/\s+/g,' ').trim();}

// ‚îÄ‚îÄ Word list ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderWords(){
  const search=(document.getElementById('w-search')?.value||'').toLowerCase();
  const lesson=document.getElementById('w-lesson')?.value||'all';
  const status=document.getElementById('w-status')?.value||'all';
  const filtered=vocab.filter(w=>{
    const ms=!search||w.ru.toLowerCase().includes(search)||w.en.toLowerCase().includes(search);
    const ml=lesson==='all'||String(w.lesson)===lesson;
    const mst=status==='all'||w.status===status||(!w.status&&status==='new');
    return ms&&ml&&mst;
  });
  const empty=document.getElementById('words-empty');
  const wrap=document.getElementById('words-tbl-wrap');
  if(vocab.length===0){if(empty)empty.style.display='block';if(wrap)wrap.style.display='none';document.getElementById('w-count').textContent='';return;}
  if(empty)empty.style.display='none';if(wrap)wrap.style.display='block';
  document.getElementById('w-count').textContent=`${filtered.length} of ${vocab.length} words`;
  const tbody=document.getElementById('w-tbody');
  tbody.innerHTML=filtered.map(w=>{
    const st=w.status||'new'; const bc=st==='known'?'bk':st==='learning'?'bl':'bn';
    return `<tr><td><span class="wru">${esc(w.ru)}</span></td><td>${esc(w.en)}</td>
      <td><span class="wgr">${esc(w.grammar||'')}</span></td>
      <td>L${w.lesson||'?'}</td>
      <td><span class="badge ${bc}">${st}</span></td>
      <td><button class="btn btn-secondary btn-sm" onclick="editW('${w.id}')">Edit</button>
          <button class="btn btn-danger btn-sm" onclick="delW('${w.id}')">‚úï</button></td>
    </tr>`;
  }).join('');
}

function editW(id){
  const w=vocab.find(v=>v.id===id); if(!w)return;
  const ru=prompt('Russian:',w.ru); if(ru===null)return;
  const en=prompt('English:',w.en); if(en===null)return;
  const gr=prompt('Grammar (optional):',w.grammar||'');
  w.ru=ru.trim()||w.ru; w.en=en.trim()||w.en; w.grammar=(gr||'').trim();
  save(); renderWords(); toast('Updated','success');
}
function delW(id){
  if(!confirm('Delete this word?'))return;
  vocab=vocab.filter(v=>v.id!==id); save(); renderWords(); renderLessonPills(); toast('Deleted');
}
function clearAll(){
  if(!confirm('Delete ALL vocabulary and progress? This cannot be undone.'))return;
  vocab=[]; save(); renderWords(); renderLessonPills(); renderQPills(); toast('All words cleared');
}
function exportJ(){
  const b=new Blob([JSON.stringify(vocab,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='russian_vocab.json'; a.click();
  toast('Exported!','success');
}

// ‚îÄ‚îÄ PDF import ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let pdfDoc=null, pdfPage=1, extractedWords=[];

const dz=document.getElementById('dz');
dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('dragover');});
dz.addEventListener('dragleave',()=>dz.classList.remove('dragover'));
dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('dragover');handlePDF({target:{files:e.dataTransfer.files}});});

async function handlePDF(evt){
  const file=evt.target.files[0]; if(!file||!file.name.endsWith('.pdf'))return;
  const lm=file.name.match(/[Ll](?:esson[_-]?)?0?(\d{1,2})/);
  if(lm) document.getElementById('ext-lesson').value=parseInt(lm[1]);
  setLoading(true,`Reading ${file.name}‚Ä¶`);
  document.getElementById('pdf-status').textContent=`üìÑ ${file.name} ‚Äî loading‚Ä¶`;
  try{
    const buf=await file.arrayBuffer();
    pdfDoc=await pdfjsLib.getDocument({data:buf}).promise;
    const n=pdfDoc.numPages;
    document.getElementById('pdf-status').textContent=`üìÑ ${file.name} ‚Äî ${n} pages. Scanning vocabulary‚Ä¶`;
    document.getElementById('pdf-viewer-area').style.display='block';
    pdfPage=n; // Start at last page
    await renderPDFPage(pdfPage);
    // Extract from last ~25% of pages
    const startP=Math.max(1,Math.floor(n*0.72));
    const allLines=[];
    for(let p=startP;p<=n;p++){
      const page=await pdfDoc.getPage(p);
      const tc=await page.getTextContent();
      const lineMap={};
      tc.items.forEach(item=>{
        const y=Math.round(item.transform[5]);
        if(!lineMap[y])lineMap[y]=[];
        lineMap[y].push({text:item.str,x:item.transform[4]});
      });
      Object.keys(lineMap).sort((a,b)=>b-a).forEach(y=>{
        const items=lineMap[y].sort((a,b)=>a.x-b.x);
        const text=items.map(i=>i.text).join('').trim();
        if(text) allLines.push({text,y:+y,x:items[0].x,page:p,items});
      });
    }
    extractedWords=parseVocab(allLines);
    setLoading(false);
    renderExtracted();
    document.getElementById('pdf-status').textContent=`‚úì Scanned ${n-startP+1} pages. Found ${extractedWords.length} vocabulary entries.`;
  }catch(err){
    setLoading(false);
    document.getElementById('pdf-status').textContent=`‚ö† Error: ${err.message}`;
    console.error(err);
  }
}

async function renderPDFPage(p){
  if(!pdfDoc)return;
  pdfPage=Math.max(1,Math.min(p,pdfDoc.numPages));
  document.getElementById('pdf-page-info').textContent=`Page ${pdfPage} / ${pdfDoc.numPages}`;
  const page=await pdfDoc.getPage(pdfPage);
  const canvas=document.getElementById('pdf-canvas');
  const wrap=document.getElementById('pdf-canvas-wrap');
  const vp=page.getViewport({scale:1});
  const scale=wrap.clientWidth/vp.width;
  const scaledVP=page.getViewport({scale});
  canvas.height=scaledVP.height; canvas.width=scaledVP.width;
  const ctx=canvas.getContext('2d');
  await page.render({canvasContext:ctx,viewport:scaledVP}).promise;
}
function changePage(d){if(pdfDoc)renderPDFPage(pdfPage+d);}
function jumpToEnd(){if(pdfDoc)renderPDFPage(pdfDoc.numPages);}

function parseVocab(lines){
  const words=[]; const seen=new Set();
  const CYR=/[\u0400-\u04FF]/; const LAT=/[a-zA-Z]/;

  // Method 1: dash-separated on one line
  lines.forEach(line=>{
    const t=line.text;
    const m=t.match(/^([\u0400-\u04FF][\u0400-\u04FF\s\-]*?)\s*[‚Äî‚Äì\u2014\u2013]\s*(.+)$/);
    if(m){
      const ru=m[1].trim(), en=m[2].trim();
      if(CYR.test(ru)&&LAT.test(en)&&en.length>1){
        const key=`${ru}|${en}`;
        if(!seen.has(key)){seen.add(key);words.push({ru:cleanW(ru),en:cleanW(en),grammar:extGram(t)});}
      }
    }
  });

  // Method 2: column layout (Cyrillic left column, English right column)
  lines.forEach(line=>{
    if(!line.items||line.items.length<2)return;
    const cyrParts=line.items.filter(i=>CYR.test(i.text));
    const latParts=line.items.filter(i=>LAT.test(i.text)&&!CYR.test(i.text));
    if(cyrParts.length>0&&latParts.length>0){
      const ru=cyrParts.map(i=>i.text).join('').trim();
      const en=latParts.map(i=>i.text).join(' ').trim();
      if(ru.length>=2&&en.length>1){
        const key=`${ru}|${en}`;
        if(!seen.has(key)){seen.add(key);words.push({ru:cleanW(ru),en:cleanW(en),grammar:extGram(ru+en)});}
      }
    }
  });

  // Method 3: alternating Cyrillic/Latin lines
  for(let i=0;i<lines.length-1;i++){
    const cur=lines[i], nxt=lines[i+1];
    if(CYR.test(cur.text)&&!LAT.test(cur.text)&&LAT.test(nxt.text)&&!CYR.test(nxt.text)&&nxt.text.length>1){
      const key=`${cur.text}|${nxt.text}`;
      if(!seen.has(key)){
        seen.add(key);
        words.push({ru:cleanW(cur.text),en:cleanW(nxt.text),grammar:extGram(cur.text+nxt.text)});
        i++;
      }
    }
  }
  return words.filter(w=>w.ru.length>=2&&w.en.length>=2&&w.ru.length<80&&w.en.length<100);
}

function cleanW(s){return s.replace(/^\s*[\d.\-*]+\s*/,'').trim().replace(/\s+/g,' ');}
function extGram(s){const m=s.match(/\((m|f|n|pl|v|adj|adv|prep|conj|pron)\)/i);return m?'('+m[1].toLowerCase()+')':'';}

function renderExtracted(){
  const list=document.getElementById('ext-list');
  const count=document.getElementById('ext-count');
  count.textContent=`${extractedWords.length} words`;
  list.innerHTML=extractedWords.map((w,i)=>`
    <div class="ext-item">
      <span class="ext-ru">${esc(w.ru)}</span>
      <span class="ext-en">${esc(w.en)}${w.grammar?' <small>'+esc(w.grammar)+'</small>':''}</span>
      <button class="btn btn-danger btn-sm" onclick="rmExt(${i})" style="padding:3px 8px;font-size:11px">‚úï</button>
    </div>`).join('');
}
function rmExt(i){extractedWords.splice(i,1);renderExtracted();}
function importExtracted(){
  if(!extractedWords.length){toast('Nothing to import','error');return;}
  const lesson=parseInt(document.getElementById('ext-lesson').value)||1;
  let added=0;
  extractedWords.forEach(w=>{
    if(!vocab.some(v=>v.ru===w.ru&&v.lesson===lesson)){
      vocab.push({id:uid(),ru:w.ru,en:w.en,grammar:w.grammar||'',lesson,status:'new',reviews:0,easiness:2.5,interval:1});
      added++;
    }
  });
  save(); renderWords(); renderLessonPills(); renderQPills();
  toast(`Added ${added} words from Lesson ${lesson}!`,'success');
  extractedWords=[]; renderExtracted();
}

// ‚îÄ‚îÄ OCR / Camera import ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let ocrWords=[];

function handleOCRImage(evt){
  const file=evt.target.files[0]; if(!file)return;
  evt.target.value=''; // allow re-selecting same file
  const url=URL.createObjectURL(file);
  const img=document.getElementById('ocr-preview');
  img.src=url;
  document.getElementById('ocr-area').style.display='block';
  document.getElementById('ocr-words-area').style.display='none';
  document.getElementById('ocr-prog-wrap').style.display='block';
  document.getElementById('ocr-prog').style.width='0%';
  document.getElementById('ocr-status').textContent='Starting OCR‚Ä¶';
  runOCR(url);
}

function loadScript(src){
  return new Promise((resolve,reject)=>{
    if(document.querySelector(`script[src="${src}"]`)){resolve();return;}
    const s=document.createElement('script');
    s.src=src; s.onload=resolve; s.onerror=reject;
    document.head.appendChild(s);
  });
}

async function runOCR(imageUrl){
  try{
    if(!window.Tesseract){
      document.getElementById('ocr-status').textContent='Loading OCR engine‚Ä¶';
      await loadScript('https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js');
    }
    document.getElementById('ocr-status').textContent='Recognizing text (Russian + English)‚Ä¶';
    const {data:{text}}=await Tesseract.recognize(imageUrl,'rus+eng',{
      logger:m=>{
        if(m.status==='loading language traineddata'){
          document.getElementById('ocr-status').textContent='Downloading language model (first use only, ~5 MB)‚Ä¶';
        } else if(m.status==='recognizing text'){
          const pct=Math.round(m.progress*100);
          document.getElementById('ocr-prog').style.width=pct+'%';
          document.getElementById('ocr-status').textContent=`Recognizing‚Ä¶ ${pct}%`;
        }
      }
    });
    document.getElementById('ocr-prog-wrap').style.display='none';
    document.getElementById('ocr-raw').value=text;
    parseOCRText(text);
  }catch(err){
    document.getElementById('ocr-prog-wrap').style.display='none';
    document.getElementById('ocr-status').textContent='‚ö† OCR error: '+err.message;
    console.error(err);
  }
}

function parseOCRText(text){
  const CYR=/[\u0400-\u04FF]/; const LAT=/[a-zA-Z]/;
  const lines=text.split('\n').map(l=>l.trim()).filter(l=>l.length>1);

  // Reuse existing PDF vocab parser
  const lineObjs=lines.map((l,i)=>({text:l,y:i,x:0,items:[]}));
  ocrWords=parseVocab(lineObjs);

  // Supplemental pass: looser separators (dash, pipe, tab, 2+ spaces)
  const seen=new Set(ocrWords.map(w=>w.ru+'|'+w.en));
  lines.forEach(line=>{
    const parts=line.split(/\s*[‚Äî‚Äì\-|]\s*|\t|\s{3,}/).map(p=>p.trim()).filter(p=>p);
    if(parts.length>=2){
      const ru=parts[0], en=parts.slice(1).join(' ').trim();
      if(CYR.test(ru)&&LAT.test(en)&&ru.length>=2&&en.length>=2){
        const key=ru+'|'+en;
        if(!seen.has(key)){seen.add(key);ocrWords.push({ru:cleanW(ru),en:cleanW(en),grammar:extGram(ru+en)});}
      }
    }
  });

  const msg=ocrWords.length>0
    ?`Found ${ocrWords.length} vocabulary pair${ocrWords.length===1?'':'s'}.`
    :'No pairs detected automatically. Edit the raw text below into "Russian ‚Äî English" format and tap ‚Ü∫ Re-parse.';
  document.getElementById('ocr-status').textContent=msg;
  document.getElementById('ocr-words-area').style.display='block';
  renderOCRWords();
}

function renderOCRWords(){
  const list=document.getElementById('ocr-list');
  document.getElementById('ocr-count').textContent=`${ocrWords.length} word${ocrWords.length===1?'':'s'}`;
  if(!ocrWords.length){
    list.innerHTML='<div style="padding:12px;font-size:13px;color:var(--text2)">No pairs found ‚Äî use the raw text field below.</div>';
    return;
  }
  list.innerHTML=ocrWords.map((w,i)=>`
    <div class="ext-item">
      <span class="ext-ru">${esc(w.ru)}</span>
      <span class="ext-en">${esc(w.en)}${w.grammar?' <small>'+esc(w.grammar)+'</small>':''}</span>
      <button class="btn btn-danger btn-sm" onclick="rmOCR(${i})" style="padding:3px 8px;font-size:11px">‚úï</button>
    </div>`).join('');
}

function rmOCR(i){ocrWords.splice(i,1);renderOCRWords();}

function reparseOCR(){
  const text=document.getElementById('ocr-raw').value;
  parseOCRText(text);
}

function importOCR(){
  if(!ocrWords.length){toast('Nothing to import','error');return;}
  const lesson=parseInt(document.getElementById('ocr-lesson').value)||1;
  let added=0;
  ocrWords.forEach(w=>{
    if(!vocab.some(v=>v.ru===w.ru&&v.lesson===lesson)){
      vocab.push({id:uid(),ru:w.ru,en:w.en,grammar:w.grammar||'',lesson,status:'new',reviews:0,easiness:2.5,interval:1});
      added++;
    }
  });
  save(); renderWords(); renderLessonPills(); renderQPills();
  toast(`Added ${added} word${added===1?'':'s'} to Lesson ${lesson}!`,'success');
  ocrWords=[]; renderOCRWords();
  document.getElementById('ocr-area').style.display='none';
}

// ‚îÄ‚îÄ Manual import ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function importBulk(){
  const text=document.getElementById('bulk-in').value.trim();
  const lesson=parseInt(document.getElementById('bulk-lesson').value)||1;
  if(!text){toast('Paste some vocabulary','error');return;}
  let added=0;
  text.split('\n').map(l=>l.trim()).filter(l=>l).forEach(line=>{
    const parts=line.split(/\s*[‚Äî‚Äì|]\s*|\t/).map(p=>p.trim()).filter(p=>p);
    if(parts.length>=2){
      const[ru,en]=parts;
      if(!vocab.some(v=>v.ru===ru&&v.lesson===lesson)){
        vocab.push({id:uid(),ru,en,grammar:'',lesson,status:'new',reviews:0,easiness:2.5,interval:1});
        added++;
      }
    }
  });
  save(); renderWords(); renderLessonPills(); renderQPills();
  document.getElementById('bulk-in').value='';
  toast(`Added ${added} words to Lesson ${lesson}!`,'success');
}

function addWord(){
  const ru=document.getElementById('m-ru').value.trim();
  const en=document.getElementById('m-en').value.trim();
  const gr=document.getElementById('m-gr').value.trim();
  const lesson=parseInt(document.getElementById('m-lesson').value)||1;
  if(!ru||!en){toast('Enter both Russian and English','error');return;}
  if(vocab.some(v=>v.ru===ru&&v.lesson===lesson)){toast('Already exists in this lesson','error');return;}
  vocab.push({id:uid(),ru,en,grammar:gr,lesson,status:'new',reviews:0,easiness:2.5,interval:1});
  save(); renderWords(); renderLessonPills(); renderQPills();
  document.getElementById('m-ru').value=''; document.getElementById('m-en').value='';
  document.getElementById('m-gr').value=''; document.getElementById('m-ru').focus();
  toast(`Added: ${ru} ‚Äî ${en}`,'success');
}

function importJSON(){
  try{
    const data=JSON.parse(document.getElementById('json-in').value);
    if(!Array.isArray(data))throw new Error('Expected array');
    let added=0;
    data.forEach(w=>{
      if(w.ru&&w.en){
        const lesson=parseInt(w.lesson)||1;
        if(!vocab.some(v=>v.ru===w.ru&&v.lesson===lesson)){
          vocab.push({id:uid(),ru:w.ru,en:w.en,grammar:w.grammar||'',lesson,
            status:w.status||'new',reviews:w.reviews||0,easiness:w.easiness||2.5,interval:w.interval||1,nextReview:w.nextReview});
          added++;
        }
      }
    });
    save(); renderWords(); renderLessonPills(); renderQPills();
    document.getElementById('json-in').value='';
    toast(`Imported ${added} words!`,'success');
  }catch(e){toast('Invalid JSON: '+e.message,'error');}
}

// ‚îÄ‚îÄ Starter vocabulary ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STARTER=[
// L1: Introductions, Alphabet, Basics
["–º–µ–Ω—è –∑–æ–≤—É—Ç","my name is","",1],["–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ","hello (formal)","",1],["–ø—Ä–∏–≤–µ—Ç","hi (informal)","",1],
["–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è","goodbye","",1],["–ø–æ–∫–∞","bye (informal)","",1],["—Å–ø–∞—Å–∏–±–æ","thank you","",1],
["–ø–æ–∂–∞–ª—É–π—Å—Ç–∞","please / you're welcome","",1],["–¥–∞","yes","",1],["–Ω–µ—Ç","no","",1],
["–∏","and","",1],["–∏–ª–∏","or","",1],["—ç—Ç–æ","this / that / it","",1],
["—è","I","",1],["–≤—ã","you (formal/plural)","",1],["—Ç—ã","you (informal)","",1],
["–æ–Ω","he","",1],["–æ–Ω–∞","she","",1],["–º—ã","we","",1],["–æ–Ω–∏","they","",1],
["–∞–º–µ—Ä–∏–∫–∞–Ω–µ—Ü / –∞–º–µ—Ä–∏–∫–∞–Ω–∫–∞","American","(m/f)",1],["—Ä—É—Å—Å–∫–∏–π / —Ä—É—Å—Å–∫–∞—è","Russian","(m/f)",1],
["–¥–∏–ø–ª–æ–º–∞—Ç","diplomat","(m)",1],["—Å—Ç—É–¥–µ–Ω—Ç / —Å—Ç—É–¥–µ–Ω—Ç–∫–∞","student","(m/f)",1],
["–∫–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç","what is your name","",1],["–æ—Ç–∫—É–¥–∞ –≤—ã","where are you from","",1],
["–æ—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω–æ","nice to meet you","",1],["—Ä–∞–¥/—Ä–∞–¥–∞ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è","glad to meet you","",1],
["–≥–æ–≤–æ—Ä–∏—Ç—å / —Å–∫–∞–∑–∞—Ç—å","to speak / to say","(v)",1],["–ø–æ–Ω–∏–º–∞—Ç—å / –ø–æ–Ω—è—Ç—å","to understand","(v)",1],
["–∑–Ω–∞—Ç—å","to know","(v)",1],["—É—á–∏—Ç—å / –≤—ã—É—á–∏—Ç—å","to study/learn","(v)",1],
// L2: Family, Numbers, Professions
["—Å–µ–º—å—è","family","(f)",2],["–º—É–∂","husband","(m)",2],["–∂–µ–Ω–∞","wife","(f)",2],
["—Å—ã–Ω","son","(m)",2],["–¥–æ—á—å","daughter","(f)",2],["–º–∞—Ç—å","mother","(f)",2],
["–æ—Ç–µ—Ü","father","(m)",2],["–±—Ä–∞—Ç","brother","(m)",2],["—Å–µ—Å—Ç—Ä–∞","sister","(f)",2],
["—Ä–µ–±—ë–Ω–æ–∫","child","(m)",2],["–¥–µ—Ç–∏","children","(pl)",2],
["–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å","teacher/lecturer","(m)",2],["–≤—Ä–∞—á","doctor","(m)",2],
["–∏–Ω–∂–µ–Ω–µ—Ä","engineer","(m)",2],["–±–∏–∑–Ω–µ—Å–º–µ–Ω","businessman","(m)",2],
["–æ–¥–∏–Ω","one","",2],["–¥–≤–∞","two","",2],["—Ç—Ä–∏","three","",2],
["—á–µ—Ç—ã—Ä–µ","four","",2],["–ø—è—Ç—å","five","",2],["—à–µ—Å—Ç—å","six","",2],
["—Å–µ–º—å","seven","",2],["–≤–æ—Å–µ–º—å","eight","",2],["–¥–µ–≤—è—Ç—å","nine","",2],["–¥–µ—Å—è—Ç—å","ten","",2],
["—Ä–∞–±–æ—Ç–∞—Ç—å","to work","(v)",2],["–∂–∏—Ç—å","to live","(v)",2],
["–ª—é–±–∏—Ç—å","to love/like","(v)",2],["–∏–º–µ—Ç—å","to have","(v)",2],
// L3: Location, City, Directions
["–∑–¥–µ—Å—å","here","",3],["—Ç–∞–º","there","",3],["–≥–¥–µ","where","",3],
["–Ω–∞–ø—Ä–∞–≤–æ","to the right","",3],["–Ω–∞–ª–µ–≤–æ","to the left","",3],["–ø—Ä—è–º–æ","straight ahead","",3],
["—É–ª–∏—Ü–∞","street","(f)",3],["–ø–ª–æ—â–∞–¥—å","square/plaza","(f)",3],["–º–µ—Ç—Ä–æ","metro/subway","(n)",3],
["–º–∞–≥–∞–∑–∏–Ω","store","(m)",3],["–±–∞–Ω–∫","bank","(m)",3],["—Ä–µ—Å—Ç–æ—Ä–∞–Ω","restaurant","(m)",3],
["–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞","hotel","(f)",3],["–ø–æ—Å–æ–ª—å—Å—Ç–≤–æ","embassy","(n)",3],
["—Ä—è–¥–æ–º","nearby","",3],["–¥–∞–ª–µ–∫–æ","far","",3],["–±–ª–∏–∑–∫–æ","close","",3],
["–Ω–∞–ª–µ–≤–æ","to the left","",3],["–Ω–∞–ø—Ä–∞–≤–æ","to the right","",3],
["–∏–¥—Ç–∏","to go (on foot)","(v)",3],["–µ—Ö–∞—Ç—å","to go (by vehicle)","(v)",3],
["–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è","to return","(v)",3],
// L4: Time, Schedule, Days
["—Å–µ–≥–æ–¥–Ω—è","today","",4],["–∑–∞–≤—Ç—Ä–∞","tomorrow","",4],["–≤—á–µ—Ä–∞","yesterday","",4],
["—Å–µ–π—á–∞—Å","now","",4],["–ø–æ—Ç–æ–º","then/later","",4],["–≤—Å–µ–≥–¥–∞","always","",4],
["–Ω–∏–∫–æ–≥–¥–∞","never","",4],["—á–∞—Å—Ç–æ","often","",4],["–∏–Ω–æ–≥–¥–∞","sometimes","",4],
["–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫","Monday","(m)",4],["–≤—Ç–æ—Ä–Ω–∏–∫","Tuesday","(m)",4],["—Å—Ä–µ–¥–∞","Wednesday","(f)",4],
["—á–µ—Ç–≤–µ—Ä–≥","Thursday","(m)",4],["–ø—è—Ç–Ω–∏—Ü–∞","Friday","(f)",4],["—Å—É–±–±–æ—Ç–∞","Saturday","(f)",4],["–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ","Sunday","(n)",4],
["—á–∞—Å","hour/o'clock","(m)",4],["–º–∏–Ω—É—Ç–∞","minute","(f)",4],["—É—Ç—Ä–æ","morning","(n)",4],
["–¥–µ–Ω—å","day/afternoon","(m)",4],["–≤–µ—á–µ—Ä","evening","(m)",4],["–Ω–æ—á—å","night","(f)",4],
["–Ω–∞—á–∏–Ω–∞—Ç—å—Å—è","to begin","(v)",4],["–∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è","to end","(v)",4],
// L5: Food, Shopping, Everyday
["—Ö–ª–µ–±","bread","(m)",5],["–º–æ–ª–æ–∫–æ","milk","(n)",5],["–≤–æ–¥–∞","water","(f)",5],
["–∫–æ—Ñ–µ","coffee","(m)",5],["—á–∞–π","tea","(m)",5],["—Å—É–ø","soup","(m)",5],
["–º—è—Å–æ","meat","(n)",5],["—Ä—ã–±–∞","fish","(f)",5],["–æ–≤–æ—â–∏","vegetables","(pl)",5],
["—Ñ—Ä—É–∫—Ç—ã","fruits","(pl)",5],["—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç","how much does it cost","",5],
["–¥–æ—Ä–æ–≥–æ","expensive","",5],["–¥—ë—à–µ–≤–æ","cheap","",5],["—Ä—É–±–ª—å","ruble","(m)",5],
["–ø–æ–∫—É–ø–∞—Ç—å / –∫—É–ø–∏—Ç—å","to buy","(v)",5],["–ø—Ä–æ–¥–∞–≤–∞—Ç—å / –ø—Ä–æ–¥–∞—Ç—å","to sell","(v)",5],
["–ø–ª–∞—Ç–∏—Ç—å / –∑–∞–ø–ª–∞—Ç–∏—Ç—å","to pay","(v)",5],
// L6: Home, Apartment
["–∫–≤–∞—Ä—Ç–∏—Ä–∞","apartment","(f)",6],["–¥–æ–º","house/building","(m)",6],
["–∫–æ–º–Ω–∞—Ç–∞","room","(f)",6],["–∫—É—Ö–Ω—è","kitchen","(f)",6],["—Å–ø–∞–ª—å–Ω—è","bedroom","(f)",6],
["–≥–æ—Å—Ç–∏–Ω–∞—è","living room","(f)",6],["–≤–∞–Ω–Ω–∞—è","bathroom","(f)",6],
["—Å—Ç–æ–ª","table","(m)",6],["—Å—Ç—É–ª","chair","(m)",6],["–¥–∏–≤–∞–Ω","sofa","(m)",6],
["–æ–∫–Ω–æ","window","(n)",6],["–¥–≤–µ—Ä—å","door","(f)",6],
["–∂–∏—Ç—å","to live","(v)",6],["—Å–Ω–∏–º–∞—Ç—å","to rent","(v)",6],
// L7: Daily Routines, Verbs of Motion
["–ø—Ä–æ—Å—ã–ø–∞—Ç—å—Å—è / –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è","to wake up","(v)",7],["–≤—Å—Ç–∞–≤–∞—Ç—å / –≤—Å—Ç–∞—Ç—å","to get up","(v)",7],
["—É–º—ã–≤–∞—Ç—å—Å—è / —É–º—ã—Ç—å—Å—è","to wash up","(v)",7],["–æ–¥–µ–≤–∞—Ç—å—Å—è / –æ–¥–µ—Ç—å—Å—è","to get dressed","(v)",7],
["–∑–∞–≤—Ç—Ä–∞–∫–∞—Ç—å / –ø–æ–∑–∞–≤—Ç—Ä–∞–∫–∞—Ç—å","to have breakfast","(v)",7],
["–æ–±–µ–¥–∞—Ç—å / –ø–æ–æ–±–µ–¥–∞—Ç—å","to have lunch","(v)",7],
["—É–∂–∏–Ω–∞—Ç—å / –ø–æ—É–∂–∏–Ω–∞—Ç—å","to have dinner","(v)",7],
["–ª–æ–∂–∏—Ç—å—Å—è / –ª–µ—á—å —Å–ø–∞—Ç—å","to go to bed","(v)",7],
["–¥–µ–ª–∞—Ç—å / —Å–¥–µ–ª–∞—Ç—å","to do/make","(v)",7],["–≥–æ—Ç–æ–≤–∏—Ç—å / –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å","to cook","(v)",7],
["—É–±–∏—Ä–∞—Ç—å / —É–±—Ä–∞—Ç—å","to clean up","(v)",7],["–≥—É–ª—è—Ç—å / –ø–æ–≥—É–ª—è—Ç—å","to go for a walk","(v)",7],
["—Ö–æ–¥–∏—Ç—å / –∏–¥—Ç–∏","to go/walk (regular/one-way)","(v)",7],
["–µ–∑–¥–∏—Ç—å / –µ—Ö–∞—Ç—å","to go/ride (regular/one-way)","(v)",7],
["—Ç–µ–ª–æ","body","(n)",7],["–≥–æ–ª–æ–≤–∞","head","(f)",7],["—Ä—É–∫–∞","hand/arm","(f)",7],
["–Ω–æ–≥–∞","foot/leg","(f)",7],["–≥–ª–∞–∑–∞","eyes","(pl)",7],["—É—à–∏","ears","(pl)",7],
["—Ä–∞—Å–ø–æ—Ä—è–¥–æ–∫ –¥–Ω—è","daily routine","(m)",7],["–¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ","homework","(n)",7],
["—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ","schedule","(n)",7],
// L8: Dining Out, Food Culture
["–º–µ–Ω—é","menu","(n)",8],["–æ—Ñ–∏—Ü–∏–∞–Ω—Ç","waiter","(m)",8],["—Å—á—ë—Ç","bill/check","(m)",8],
["–∑–∞–∫–∞–∑—ã–≤–∞—Ç—å / –∑–∞–∫–∞–∑–∞—Ç—å","to order","(v)",8],["–∑–∞–ø–ª–∞—Ç–∏—Ç—å","to pay","(v)",8],
["–±–ª—é–¥–æ","dish/course","(n)",8],["–∑–∞–∫—É—Å–∫–∞","appetizer/snack","(f)",8],
["–ø–µ—Ä–≤–æ–µ","first course (soup)","(n)",8],["–≤—Ç–æ—Ä–æ–µ","main course","(n)",8],
["–¥–µ—Å–µ—Ä—Ç","dessert","(m)",8],["–Ω–∞–ø–∏—Ç–æ–∫","drink/beverage","(m)",8],
["–±–æ—Ä—â","borscht","(m)",8],["–ø–µ–ª—å–º–µ–Ω–∏","dumplings","(pl)",8],
["–ø–∏—Ä–æ–≥–∏","pies","(pl)",8],["–±–ª–∏–Ω—ã","pancakes","(pl)",8],
["–∏–∫—Ä–∞","caviar","(f)",8],["—Å–∞–ª–∞—Ç","salad","(m)",8],
["–≤–∏–ª–∫–∞","fork","(f)",8],["–ª–æ–∂–∫–∞","spoon","(f)",8],["–Ω–æ–∂","knife","(m)",8],
["—Ç–∞—Ä–µ–ª–∫–∞","plate","(f)",8],["—Å—Ç–∞–∫–∞–Ω","glass","(m)",8],["–±–æ–∫–∞–ª","wine glass","(m)",8],
["–≤–∫—É—Å–Ω—ã–π","delicious/tasty","(adj)",8],["—Å–≤–µ–∂–∏–π","fresh","(adj)",8],
["–æ—Å—Ç—Ä—ã–π","spicy/sharp","(adj)",8],["—Å–ª–∞–¥–∫–∏–π","sweet","(adj)",8],
// L9: Health, Medical
["–∑–¥–æ—Ä–æ–≤—å–µ","health","(n)",9],["–±–æ–ª–µ—Ç—å","to be sick / to hurt","(v)",9],
["–±–æ–ª—å","pain","(f)",9],["–≥–æ–ª–æ–≤–∞ –±–æ–ª–∏—Ç","head hurts","",9],
["—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞","temperature/fever","(f)",9],["–Ω–∞—Å–º–æ—Ä–∫","runny nose","(m)",9],
["–∫–∞—à–µ–ª—å","cough","(m)",9],["–∞–ª–ª–µ—Ä–≥–∏—è","allergy","(f)",9],
["–≤—Ä–∞—á","doctor","(m)",9],["–±–æ–ª—å–Ω–∏—Ü–∞","hospital","(f)",9],["–∞–ø—Ç–µ–∫–∞","pharmacy","(f)",9],
["–ª–µ–∫–∞—Ä—Å—Ç–≤–æ","medicine","(n)",9],["—Ç–∞–±–ª–µ—Ç–∫–∞","tablet/pill","(f)",9],
["—Ä–µ—Ü–µ–ø—Ç","prescription/recipe","(m)",9],
["—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è","to feel (oneself)","(v)",9],
["—Ö–æ—Ä–æ—à–æ","well/good","",9],["–ø–ª–æ—Ö–æ","badly/bad","",9],["–ª—É—á—à–µ","better","",9],
["—Ö—É–∂–µ","worse","",9],["–Ω—É–∂–Ω–æ","(it is) necessary","",9],
["–µ—Å–ª–∏ –±—ã","if (conditional)","",9],["—á—Ç–æ–±—ã","in order to","",9],
// L10: Education, Academic Life
["—à–∫–æ–ª–∞","school","(f)",10],["—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç","university","(f)",10],
["–∏–Ω—Å—Ç–∏—Ç—É—Ç","institute","(m)",10],["—Ñ–∞–∫—É–ª—å—Ç–µ—Ç","faculty/department","(m)",10],
["–ª–µ–∫—Ü–∏—è","lecture","(f)",10],["—Å–µ–º–∏–Ω–∞—Ä","seminar","(m)",10],
["—ç–∫–∑–∞–º–µ–Ω","exam","(m)",10],["–∑–∞—á—ë—Ç","test/credit","(m)",10],
["–æ—Ü–µ–Ω–∫–∞","grade/evaluation","(f)",10],["–¥–∏–ø–ª–æ–º","diploma","(m)",10],
["–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞","mathematics","(f)",10],["—Ñ–∏–∑–∏–∫–∞","physics","(f)",10],
["—Ö–∏–º–∏—è","chemistry","(f)",10],["–±–∏–æ–ª–æ–≥–∏—è","biology","(f)",10],
["–∏—Å—Ç–æ—Ä–∏—è","history","(f)",10],["—ç–∫–æ–Ω–æ–º–∏–∫–∞","economics","(f)",10],
["–ø–æ–ª–∏—Ç–æ–ª–æ–≥–∏—è","political science","(f)",10],["–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è","international relations","(pl)",10],
["–ø–æ—Å—Ç—É–ø–∞—Ç—å / –ø–æ—Å—Ç—É–ø–∏—Ç—å","to enroll/enter (institution)","(v)",10],
["—Å–¥–∞–≤–∞—Ç—å / —Å–¥–∞—Ç—å","to pass (exam)","(v)",10],
["–∫–æ—Ç–æ—Ä—ã–π","which/that (relative)","",10],["–ø–æ—Ç–æ–º—É —á—Ç–æ","because","",10],
// L11: Travel, Transportation
["–∞—ç—Ä–æ–ø–æ—Ä—Ç","airport","(m)",11],["—Å–∞–º–æ–ª—ë—Ç","airplane","(m)",11],
["–ø–æ–µ–∑–¥","train","(m)",11],["–∞–≤—Ç–æ–±—É—Å","bus","(m)",11],["—Ç–∞–∫—Å–∏","taxi","(n)",11],
["–º–µ—Ç—Ä–æ","metro","(n)",11],["–º–∞—à–∏–Ω–∞","car","(f)",11],
["–±–∏–ª–µ—Ç","ticket","(m)",11],["–ø–∞—Å–ø–æ—Ä—Ç","passport","(m)",11],["–≤–∏–∑–∞","visa","(f)",11],
["–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞","hotel","(f)",11],["–Ω–æ–º–µ—Ä","room/number","(m)",11],
["–ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å","to travel","(v)",11],["–ª–µ—Ç–µ—Ç—å / –ª–µ—Ç–∞—Ç—å","to fly","(v)",11],
["–ø—Ä–∏–µ–∑–∂–∞—Ç—å / –ø—Ä–∏–µ—Ö–∞—Ç—å","to arrive (by vehicle)","(v)",11],
["—É–µ–∑–∂–∞—Ç—å / —É–µ—Ö–∞—Ç—å","to leave (by vehicle)","(v)",11],
["–ø–µ—Ä–µ—Å–∞–¥–∫–∞","transfer/connection","(f)",11],["—Ç–∞–º–æ–∂–Ω—è","customs","(f)",11],
["–∫–∞—Ä—Ç–∞","map","(f)",11],["—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π","tourist","(adj)",11],
["—Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–µ–ø–µ–Ω—å","comparative degree","",11],["–±—ã—Å—Ç—Ä–µ–µ","faster","",11],
// L12: Work, Careers
["—Ä–∞–±–æ—Ç–∞","work/job","(f)",12],["–æ—Ñ–∏—Å","office","(m)",12],
["–∫–æ–º–ø–∞–Ω–∏—è","company","(f)",12],["—Ñ–∏—Ä–º–∞","firm","(f)",12],
["–¥–æ–ª–∂–Ω–æ—Å—Ç—å","position/post","(f)",12],["–∫–∞—Ä—å–µ—Ä–∞","career","(f)",12],
["—Ä–µ–∑—é–º–µ","resume/CV","(n)",12],["—Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ","interview","(n)",12],
["–∑–∞—Ä–ø–ª–∞—Ç–∞","salary","(f)",12],["–æ—Ç–ø—É—Å–∫","vacation/leave","(m)",12],
["–∫–æ–ª–ª–µ–≥–∞","colleague","(m/f)",12],["–Ω–∞—á–∞–ª—å–Ω–∏–∫","boss/head","(m)",12],
["—Å–æ—Ç—Ä—É–¥–Ω–∏–∫","employee/colleague","(m)",12],["—Å–ª—É–∂–∞—â–∏–π","employee/official","(m)",12],
["–∑–∞–Ω–∏–º–∞—Ç—å—Å—è","to engage in / study","(v)",12],["–Ω–∞–Ω–∏–º–∞—Ç—å / –Ω–∞–Ω—è—Ç—å","to hire","(v)",12],
["—É–≤–æ–ª—å–Ω—è—Ç—å / —É–≤–æ–ª–∏—Ç—å","to fire","(v)",12],
["—Å–æ–≤–µ—â–∞–Ω–∏–µ","meeting","(n)",12],["–∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞","business trip","(f)",12],
["–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π","professional","(adj)",12],
["—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ä–∞—á–æ–º","to work as a doctor","",12],
// L13: Arts, Culture, Entertainment
["—Ç–µ–∞—Ç—Ä","theater","(m)",13],["–∫–∏–Ω–æ / –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä","cinema","(n/m)",13],
["–º—É–∑–µ–π","museum","(m)",13],["–≤—ã—Å—Ç–∞–≤–∫–∞","exhibition","(f)",13],
["–∫–æ–Ω—Ü–µ—Ä—Ç","concert","(m)",13],["—Å–ø–µ–∫—Ç–∞–∫–ª—å","performance/show","(m)",13],
["–æ–ø–µ—Ä–∞","opera","(f)",13],["–±–∞–ª–µ—Ç","ballet","(m)",13],
["—Ñ–∏–ª—å–º","film/movie","(m)",13],["–∫–Ω–∏–≥–∞","book","(f)",13],
["—Ä–æ–º–∞–Ω","novel","(m)",13],["—Ä–∞—Å—Å–∫–∞–∑","short story","(m)",13],
["—Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ","poem","(n)",13],["–º—É–∑—ã–∫–∞","music","(f)",13],
["—Ö—É–¥–æ–∂–Ω–∏–∫","artist/painter","(m)",13],["–ø–∏—Å–∞—Ç–µ–ª—å","writer","(m)",13],
["–∞–∫—Ç—ë—Ä","actor","(m)",13],["—Ä–µ–∂–∏—Å—Å—ë—Ä","director","(m)",13],
["–Ω—Ä–∞–≤–∏—Ç—å—Å—è / –ø–æ–Ω—Ä–∞–≤–∏—Ç—å—Å—è","to like / to please","(v)",13],
["—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å","to recommend","(v)",13],["—Å–æ–≤–µ—Ç–æ–≤–∞—Ç—å","to advise","(v)",13],
["–ø–æ –º–Ω–µ–Ω–∏—é","in the opinion of","",13],["–¥—É–º–∞—é, —á—Ç–æ","I think that","",13],
["–¥–µ–µ–ø—Ä–∏—á–∞—Å—Ç–∏–µ","verbal adverb (gerund)","(n)",13],
// L14: Media, Society, Politics
["–Ω–æ–≤–æ—Å—Ç–∏","news","(pl)",14],["–≥–∞–∑–µ—Ç–∞","newspaper","(f)",14],
["–∂—É—Ä–Ω–∞–ª","magazine","(m)",14],["—Ç–µ–ª–µ–≤–∏–¥–µ–Ω–∏–µ","television","(n)",14],
["—Ä–∞–¥–∏–æ","radio","(n)",14],["–∏–Ω—Ç–µ—Ä–Ω–µ—Ç","internet","(m)",14],
["—Å—Ç–∞—Ç—å—è","article","(f)",14],["—Ä–µ–ø–æ—Ä—Ç–∞–∂","report","(m)",14],
["–∂—É—Ä–Ω–∞–ª–∏—Å—Ç","journalist","(m)",14],["—Ä–µ–¥–∞–∫—Ç–æ—Ä","editor","(m)",14],
["–ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ","government","(n)",14],["–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç","president","(m)",14],
["–º–∏–Ω–∏—Å—Ç—Ä","minister","(m)",14],["–ø–∞—Ä–ª–∞–º–µ–Ω—Ç","parliament","(m)",14],
["–≤—ã–±–æ—Ä—ã","elections","(pl)",14],["–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å","to vote","(v)",14],
["—ç–∫–æ–Ω–æ–º–∏–∫–∞","economy","(f)",14],["–æ–±—â–µ—Å—Ç–≤–æ","society","(n)",14],
["–æ–∫—Ä—É–∂–∞—é—â–∞—è —Å—Ä–µ–¥–∞","environment","(f)",14],["–∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∏–º–∞—Ç–∞","climate change","(n)",14],
["–ø–æ –º–æ–µ–º—É –º–Ω–µ–Ω–∏—é","in my opinion","",14],["—Å–ª–µ–¥—É–µ—Ç","one should/ought to","",14],
["–ø—Ä–æ–±–ª–µ–º–∞","problem","(f)",14],["—Ä–µ—à–µ–Ω–∏–µ","solution/decision","(n)",14],
];

function loadStarter(){
  let added=0;
  STARTER.forEach(([ru,en,grammar,lesson])=>{
    if(!vocab.some(v=>v.ru===ru&&v.lesson===lesson)){
      vocab.push({id:uid(),ru,en,grammar,lesson,status:'new',reviews:0,easiness:2.5,interval:1});
      added++;
    }
  });
  save(); renderWords(); renderLessonPills(); renderQPills();
  toast(`Loaded ${added} starter words across all 14 lessons!`,'success');
  showTab('study');
}

// ‚îÄ‚îÄ Utilities ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function uid(){return Math.random().toString(36).substr(2,9)+Date.now().toString(36);}
function shuffle(a){const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;}
function esc(s){if(!s)return'';return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function toast(msg,type=''){
  const c=document.getElementById('toast-c');
  const el=document.createElement('div'); el.className='toast'+(type?' '+type:''); el.textContent=msg;
  c.appendChild(el); setTimeout(()=>el.remove(),3000);
}
function setLoading(show,txt='Processing‚Ä¶'){
  const el=document.getElementById('loading'); el.style.display=show?'flex':'none';
  document.getElementById('load-txt').textContent=txt;
}

// Keyboard
document.addEventListener('keydown',e=>{
  if(['INPUT','TEXTAREA','SELECT'].includes(e.target.tagName))return;
  const tab=document.querySelector('.tab.active').id;
  if(tab==='tab-study'&&document.getElementById('fc-area').style.display!=='none'){
    if(e.code==='Space'){e.preventDefault();flipCard();}
    if(flipped){if(e.key==='1')rate('hard');if(e.key==='2')rate('ok');if(e.key==='3')rate('easy');}
  }
});

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
load();

// Prompt first-time users
if(vocab.length===0){
  setTimeout(()=>{
    if(confirm('Welcome to Russian Vocab Trainer!\n\nLoad the starter vocabulary (~500 words across all 14 lessons) to get started right away?')){
      loadStarter();
    }
  },500);
}

// Register service worker for offline / PWA support
if('serviceWorker' in navigator){
  window.addEventListener('load',()=>{
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  });
}
</script>
</body>
</html>
